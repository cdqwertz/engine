<html>
	<head>
		<title>Game</title>
		<style>
			#screen {
				position:absolute;
				top:0px;
				left:0px;
			}
		</style>
	</head>
	<body onload="onInit()">
		<canvas id="screen"></canvas>

		<script src="vector.js"></script>
		<script src="input.js"></script>
		<script src="actor.js"></script>
		<script src="scene.js"></script>
		<script src="components.js"></script>
		<script src="physics.js"></script>
		<script src="core.js"></script>

		<script>
			//Test component
			function move(type, speed, jumpForce) {
				this.componentType = "move";
				this.t = null;
				this.type = type || 0;
				this.speed = speed || 0;
				this.jumpForce = jumpForce || speed;

				this.start =  function(obj) {
					this.t = obj.getComponent("transform");
				};

				this.update = function(obj) {
					if(this.type == 0) {
						if (input.getKey(38) == true) {
							this.t.p = this.t.p.add(new vec2(0, -this.speed*time.dtime));
						}
						if (input.getKey(37) == true) {
							this.t.p = this.t.p.add(new vec2(-this.speed*time.dtime, 0));
						}
						if (input.getKey(39) == true) {
							this.t.p = this.t.p.add(new vec2(this.speed*time.dtime, 0));
						}
						if (input.getKey(40) == true) {
							this.t.p = this.t.p.add(new vec2(0, this.speed*time.dtime));
						}
					} else if(this.type == 1) {
						if (input.getKey(38) == true) {
							this.t.p = this.t.p.add(new vec2(0, -this.jumpForce*time.dtime));
						}
						if (input.getKey(37) == true) {
							this.t.p = this.t.p.add(new vec2(-this.speed*time.dtime, 0));
						}
						if (input.getKey(39) == true) {
							this.t.p = this.t.p.add(new vec2(this.speed*time.dtime, 0));
						}
						if (input.getKey(40) == true) {
							this.t.p = this.t.p.add(new vec2(0, this.jumpForce*time.dtime));
						}
					}
				};
			}

			//Load

			function load()
			{
				var ball = new actor();
				ball.addComponent(new transform(new vec2(200, 100), 0));
				//ball.addComponent(new bounce());
				ball.addComponent(new move(0, 0.7));
				ball.addComponent(new velocity(new vec2(0, 0), 0));
				var ballColl = new boxCollider(0, 0, 50, 50, "wall", true)
				ball.addComponent(ballColl);
				ball.addComponent(new simpleRigidbody());
				ball.addComponent(new drawRect(new vec2(0, 0), new vec2(50, 50)));

				mainScene.addObject(ball);

				var wall1 = new actor();
				wall1.addComponent(new transform(new vec2(25, screen.h/2), 0));
				var wall1Coll = new boxCollider(0,0, 50, screen.h, "wall", false)
				wall1.addComponent(wall1Coll);
				wall1.addComponent(new drawRect(new vec2(0, 0), new vec2(50, screen.h)));

				mainScene.addObject(wall1);

				var wall2 = new actor();
				wall2.addComponent(new transform(new vec2(screen.w-25, screen.h/2), 0));
				var wall2Coll = new boxCollider(0,0, 50, screen.h, "wall", false)
				wall2.addComponent(wall2Coll);
				wall2.addComponent(new drawRect(new vec2(0, 0), new vec2(50, screen.h)));

				mainScene.addObject(wall2);

				var wall3 = new actor();
				wall3.addComponent(new transform(new vec2(screen.w/2, 25), 0));
				var wall3Coll = new boxCollider(0,0, screen.w, 50, "wall", false)
				wall3.addComponent(wall3Coll);
				wall3.addComponent(new drawRect(new vec2(0, 0), new vec2(screen.w, 50)));

				mainScene.addObject(wall3);

				var wall4 = new actor();
				wall4.addComponent(new transform(new vec2(screen.w/2, screen.h-25), 0));
				var wall4Coll = new boxCollider(0,0, screen.w, 50, "wall", false)
				wall4.addComponent(wall4Coll);
				wall4.addComponent(new drawRect(new vec2(0, 0), new vec2(screen.w, 50)));

				mainScene.addObject(wall4);

				var wall5 = new actor();
				wall5.addComponent(new transform(new vec2(screen.w/2, screen.h/2), 0));
				var wall5Coll = new boxCollider(0,0, 100, 100, "wall", true)
				wall5.addComponent(wall5Coll);
				wall5.addComponent(new velocity(new vec2(0.4, 0.2), 0));
				wall5.addComponent(new bounce());
				wall5.addComponent(new drawRect(new vec2(0, 0), new vec2(100, 100)));

				mainScene.addObject(wall5);

				
				var collLayer = new collisionLayer();
				collLayer.addCollider(ballColl);
				collLayer.addCollider(wall1Coll);
				collLayer.addCollider(wall2Coll);
				collLayer.addCollider(wall3Coll);
				collLayer.addCollider(wall4Coll);
				collLayer.addCollider(wall5Coll);
				physicsLayers.addLayer(collLayer);

				//mainScene.addObject(test);
			}
		</script>
	</body>
</html>
